<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TARA – Detail Komunitas</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Space+Grotesk:wght@600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: #ffffff;
            color: #111827;
            box-sizing: border-box;
        }

        *,
        *::before,
        *::after {
            box-sizing: inherit;
        }

        .community-banner {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .post-card {
            background: linear-gradient(145deg, #ffffff, #f9fafb);
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .post-card h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
            margin: 0 0 0.75rem;
        }

        .post-card p {
            font-size: 1rem;
            color: #4b5563;
            margin: 0 0 1rem;
            line-clamp: 3;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .vote-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .attachment-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .attachment-container img {
            max-width: 100px;
            border-radius: 8px;
        }

        .attachment-container a {
            color: #2563eb;
            text-decoration: underline;
        }

        .recommended-community {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
        }

        .recommended-community img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: 9999px;
            margin-left: 0.5rem;
        }

        .badge-populer {
            background: linear-gradient(90deg, #facc15, #fde68a);
            color: #111827;
        }

        .badge-baru {
            background: linear-gradient(90deg, #d1fae5, #a7f3d0);
            color: #065f46;
        }

        .badge-moderator {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            color: #ffffff;
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #facc15;
            color: #111827;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: 9999px;
            padding: 0.1rem 0.5rem;
        }

        .join-btn {
            padding: 0.5rem 1.5rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            background: linear-gradient(90deg, #111827, #374151);
            color: #ffffff;
        }

        .sidebar {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 2rem;
        }

        .sidebar a {
            display: block;
            padding: 0.5rem 0;
            color: #374151;
            font-weight: 500;
        }

        .notification-bar {
            background: linear-gradient(145deg, #f3f4f6, #e5e7eb);
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            cursor: pointer;
        }

        .notification-modal {
            position: fixed;
            top: 0;
            right: 0;
            height: 100%;
            width: 100%;
            max-width: 400px;
            background: #ffffff;
            border-left: 1px solid #e5e7eb;
            z-index: 50;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification-modal.open {
            transform: translateX(0);
        }

        .notification-modal .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            color: #374151;
            cursor: pointer;
        }

        .notification-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
        }

        .notification-card.unread {
            background: linear-gradient(145deg, #f3f4f6, #e5e7eb);
        }

        .notification-card p {
            font-size: 0.9rem;
            color: #4b5563;
        }

        .notification-card .time {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid #e5e7eb;
            background: #f3f4f6;
            color: #374151;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: linear-gradient(90deg, #111827, #374151);
            color: #ffffff;
            border-color: #facc15;
        }

        .vote-btn {
            cursor: pointer;
            font-size: 1rem;
        }

        .event-item {
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
        }

        .community-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .highlight-post {
            border-left: 4px solid #facc15;
            background: linear-gradient(145deg, #fefce8, #f3f4f6);
        }

        .moderator-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 60;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .moderator-modal.open {
            opacity: 1;
            visibility: visible;
        }

        .moderator-modal-content {
            background: #ffffff;
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .moderator-modal-content .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            color: #374151;
            cursor: pointer;
        }

        .show-more-btn {
            color: #2563eb;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 0.5rem;
            display: inline-block;
        }

        /* New Moderator List Styles */
        .moderator-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .moderator-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.2s ease;
        }

        .moderator-item:last-child {
            border-bottom: none;
        }

        .moderator-item:hover {
            background: #f9fafb;
        }

        .moderator-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #374151;
            font-size: 1.25rem;
        }

        .moderator-name {
            flex: 1;
            font-size: 1rem;
            font-weight: 500;
            color: #111827;
        }

        @media (min-width: 768px) {
            .community-section {
                flex-direction: row;
                align-items: flex-start;
            }
        }

        @media (max-width: 768px) {
            .notification-modal {
                width: 100%;
                max-width: 100%;
            }
            .sidebar {
                padding: 1.5rem;
            }
            .post-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            .moderator-item {
                padding: 0.5rem;
            }
            .moderator-icon {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
        }
    </style>
</head>

<body class="relative overflow-x-hidden">
    <!-- Notification Modal -->
    <div id="notification-modal" class="notification-modal">
        <i class="fas fa-times close-btn" onclick="toggleNotifications()"></i>
        <div class="p-6">
            <h2 class="text-2xl font-bold text-black mb-4" style="font-family: 'Space Grotesk', sans-serif;">Notifikasi</h2>
            <div class="flex gap-2 mb-4">
                <button class="filter-btn active" data-filter="all">Semua</button>
                <button class="filter-btn" data-filter="unread">Belum Dibaca</button>
            </div>
            <button id="mark-all-read" class="px-4 py-2 mb-4 bg-black text-white text-sm rounded-full">Tandai Semua Dibaca</button>
            <div id="notification-list" class="space-y-4"></div>
        </div>
    </div>

    <!-- Moderator Modal -->
    <div id="moderator-modal" class="moderator-modal">
        <div class="moderator-modal-content">
            <i class="fas fa-times close-btn" onclick="toggleModeratorModal()"></i>
            <h2 class="text-2xl font-bold text-black mb-4" style="font-family: 'Space Grotesk', sans-serif;">Daftar Moderator</h2>
            <ul id="moderator-list" class="moderator-list"></ul>
        </div>
    </div>

    <!-- Header -->
    <header class="py-6 px-8 flex justify-between items-center bg-white shadow-sm border-b border-gray-200 z-40 fixed top-0 left-0 w-full">
        <div class="text-2xl font-bold uppercase tracking-wide" style="font-family: 'Space Grotesk', sans-serif;">
            TARA<span class="text-accent">●</span>
        </div>
        <nav class="hidden md:flex space-x-6 text-sm text-gray-700">
            <a href="/" class="hover:text-black">Beranda</a>
            <a href="/eksplor" class="hover:text-black">Eksplor</a>
            <a href="/komunitas" class="hover:text-black font-semibold">Komunitas</a>
            <a href="/proyek" class="hover:text-black">Proyek</a>
            <a href="/blog" class="hover:text-black">Blog</a>
            <a href="/agenda" class="hover:text-black">Agenda</a>
            <a href="/profil" class="hover:text-black">Profil</a>
        </nav>
        <div class="flex items-center gap-4">
            <input type="text" placeholder="Cari karya, komunitas, proyek..." class="px-4 py-1.5 rounded-full bg-gray-100 text-sm text-gray-700 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-black" />
            <div class="relative">
                <i class="fas fa-bell text-gray-500 cursor-pointer" onclick="toggleNotifications()"></i>
                <span class="notification-badge" id="unread-count">0</span>
            </div>
            <a href="/login" class="px-4 py-2 bg-black text-white text-sm rounded-full">Login</a>
        </div>
    </header>

    <!-- Community Detail Section -->
    <section class="relative pt-24 pb-12 bg-white">
        <div class="max-w-7xl mx-auto px-6">
            <!-- Notification Bar -->
            <div id="notification-bar" class="notification-bar hidden" onclick="dismissNotification()">
                <p class="text-sm text-gray-700">Selamat datang di komunitas! Lihat aktivitas terbaru.</p>
            </div>

            <!-- Main Content and Sidebar -->
            <div class="community-section">
                <!-- Main Content -->
                <div class="flex-1">
                    <div class="mb-4 flex items-center gap-4">
                        <a href="/komunitas.html" class="inline-block px-6 py-2 bg-black text-white text-sm rounded-full" aria-label="Kembali ke Komunitas">Kembali ke Komunitas</a>
                        <a href="/forum.html?community=${getCommunityId()}" class="inline-block px-6 py-2 bg-gray-600 text-white text-sm rounded-full" aria-label="Ke Forum Diskusi">Forum Diskusi</a>
                    </div>
                    <div id="community-detail" class="mb-8">
                        <img id="community-image" class="community-banner" src="" alt="" />
                        <div class="mt-4">
                            <div class="flex items-center gap-2 mb-2">
                                <h1 id="community-name" class="text-3xl font-bold text-black" style="font-family: 'Space Grotesk', sans-serif;"></h1>
                                <span id="community-badge" class="badge"></span>
                            </div>
                            <p id="community-description" class="text-lg text-gray-600 mb-4"></p>
                        </div>
                    </div>
                    <span id="community-members" class="text-sm text-gray-500 mb-4 block"><i class="fas fa-user-friends mr-1"></i></span>
                    <h2 class="text-2xl font-bold text-black mb-4" style="font-family: 'Space Grotesk', sans-serif;">Aktivitas Komunitas</h2>
                    <div id="community-posts" class="space-y-6"></div>
                </div>

                <!-- Sidebar -->
                <aside class="sidebar md:w-80">
                    <h3 class="text-2xl font-semibold text-black mb-4" style="font-family: 'Space Grotesk', sans-serif;">Tentang Komunitas</h3>
                    <div id="sidebar-community-details" class="space-y-4 mb-6 border-l-4 border-yellow-400 pl-4">
                        <p id="sidebar-community-name" class="text-base font-semibold text-gray-700"></p>
                        <p id="sidebar-community-category" class="text-xs text-gray-500"></p>
                        <p id="sidebar-community-description" class="text-sm text-gray-600"></p>
                        <p id="sidebar-community-creator" class="text-sm text-gray-500"></p>
                        <p id="sidebar-community-created" class="text-sm text-gray-500"></p>
                        <p id="sidebar-community-discussions" class="text-sm text-gray-500"></p>
                        <p id="sidebar-community-moderators" class="text-sm text-gray-500"></p>
                        <span id="show-more-moderators" class="show-more-btn hidden">Show More Moderator</span>
                    </div>
                    <div id="sidebar-community-stats" class="flex items-center gap-4 mb-6">
                        <span id="sidebar-community-members" class="text-sm text-gray-500"></span>
                        <span id="sidebar-community-online" class="text-sm text-gray-500"></span>
                    </div>
                    <h3 class="text-2xl font-semibold text-black mb-4" style="font-family: 'Space Grotesk', sans-serif;">Jadwal Event</h3>
                    <div id="sidebar-community-events" class="space-y-4 mb-6"></div>
                    <h3 class="text-2xl font-semibold text-black mb-4" style="font-family: 'Space Grotesk', sans-serif;">Peraturan Komunitas</h3>
                    <div id="sidebar-community-rules" class="space-y-4 mb-6">
                        <p class="text-sm text-gray-600">1. Hormati anggota lain.</p>
                        <p class="text-sm text-gray-600">2. Dilarang memposting konten yang melanggar hukum.</p>
                        <p class="text-sm text-gray-600">3. Gunakan bahasa yang sopan.</p>
                        <p class="text-sm text-gray-600">4. Dilarang spam atau promosi tanpa izin.</p>
                    </div>
                </aside>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 text-gray-700 text-sm">
        <div class="max-w-7xl mx-auto px-6 py-16 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-10">
            <div class="col-span-1 sm:col-span-2">
                <div class="text-2xl font-bold tracking-normal uppercase" style="font-family: 'Space Grotesk', sans-serif;">
                    TARA<span class="text-accent">●</span>
                </div>
                <p class="text-gray-700 mt-4">Rumah bagi karya visual menawan, inovasi muda, dan estetika web masa depan.</p>
                <div class="flex gap-4 mt-4 text-gray-700 text-lg">
                    <a href="#" class="hover:text-black" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="hover:text-black" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="hover:text-black" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
                    <a href="#" class="hover:text-black" aria-label="Dribbble"><i class="fab fa-dribbble"></i></a>
                    <a href="#" class="hover:text-black" aria-label="Behance"><i class="fab fa-behance"></i></a>
                </div>
            </div>
            <div>
                <h3 class="font-semibold text-black mb-4 uppercase">Navigasi</h3>
                <ul class="space-y-2">
                    <li><a href="/" class="hover:text-black">Beranda</a></li>
                    <li><a href="/eksplor" class="hover:text-black">Eksplor Karya</a></li>
                    <li><a href="/komunitas" class="hover:text-black">Komunitas</a></li>
                    <li><a href="/proyek" class="hover:text-black">Proyek Sosial</a></li>
                    <li><a href="/blog" class="hover:text-black">Blog</a></li>
                    <li><a href="/agenda" class="hover:text-black">Agenda</a></li>
                </ul>
            </div>
            <div>
                <h3 class="font-semibold text-black mb-4 uppercase">Eksplorasi</h3>
                <ul class="space-y-2">
                    <li><a href="/eksplor?kategori=puisi" class="hover:text-black">Puisi</a></li>
                    <li><a href="/eksplor?kategori=desain" class="hover:text-black">Desain</a></li>
                    <li><a href="/eksplor?kategori=musik" class="hover:text-black">Musik</a></li>
                    <li><a href="/eksplor?kategori=coding" class="hover:text-black">Coding</a></li>
                </ul>
            </div>
            <div>
                <h3 class="font-semibold text-black mb-4 uppercase">Kolaborasi</h3>
                <ul class="space-y-2">
                    <li><a href="/proyek/submit" class="hover:text-black">Submit Karya</a></li>
                    <li><a href="/komunitas/gabung" class="hover:text-black">Gabung Komunitas</a></li>
                    <li><a href="/proyek/buat" class="hover:text-black">Buat Proyek</a></li>
                    <li><a href="/kontak" class="hover:text-black">Kontak</a></li>
                </ul>
            </div>
            <div>
                <h3 class="font-semibold text-black mb-4 uppercase">Newsletter</h3>
                <p class="text-gray-700 mb-3">Dapatkan inspirasi mingguan di kotak masuk Tuan.</p>
                <div class="flex items-center gap-2">
                    <input type="email" placeholder="Email Tuan..." class="w-full px-3 py-2 border border-gray-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-black" />
                    <button class="px-4 py-2 bg-black text-white text-sm rounded-md">Kirim</button>
                </div>
            </div>
        </div>
        <div class="border-t border-gray-200 text-center py-4 text-xs text-gray-700">
            © 2025 TARA. Dirakit dengan semangat di bumi Nusantara.
            <a href="/tentang" class="hover:text-black">Tentang Kami</a> |
            <a href="/ketentuan" class="hover:text-black">Ketentuan Layanan</a> |
            <a href="/privasi" class="hover:text-black">Privasi</a> |
            <a href="/bantuan" class="hover:text-black">Bantuan</a>
        </div>
    </footer>

    <script>
        // Simulated Community Data
        const communities = [
            { id: 1, name: "Komunitas Puisi", category: "Puisi", description: "Berbagi kata, menenun makna dalam puisi. Bergabunglah untuk mengeksplorasi keindahan bahasa dan emosi.", members: 1200, image: "https://picsum.photos/600/400?poetry", badge: "populer", joined: true, createdDate: "Januari 2023", creator: "Rudi Santoso", onlineMembers: 50, moderators: [{ name: "Budi", isModerator: true }, { name: "Siti", isModerator: true }, { name: "Tina", isModerator: true }, { name: "Rudi", isModerator: true }] },
            { id: 2, name: "Komunitas Desain", category: "Desain", description: "Ciptakan visual yang memukau bersama desainer berbakat dari seluruh Indonesia.", members: 850, image: "https://picsum.photos/600/400?design", badge: "populer", joined: true, createdDate: "Maret 2022", creator: "Lina Wijaya", onlineMembers: 45, moderators: [{ name: "Andi", isModerator: true }, { name: "Rina", isModerator: true }, { name: "Dika", isModerator: true }] },
            { id: 3, name: "Komunitas Musik", category: "Musik", description: "Melodi yang menginspirasi dari musisi muda. Diskusikan karya dan kolaborasi musik.", members: 600, image: "https://picsum.photos/600/400?music", badge: "baru", joined: false, createdDate: "Juni 2024", creator: "Aryo Pratama", onlineMembers: 30, moderators: [{ name: "Dedi", isModerator: true }] },
            { id: 4, name: "Komunitas Coding", category: "Coding", description: "Inovasi teknologi dari para developer. Berbagi kode dan proyek open-source.", members: 450, image: "https://picsum.photos/600/400?coding", badge: "baru", joined: false, createdDate: "Agustus 2023", creator: "Sari Indah", onlineMembers: 25, moderators: [{ name: "Eko", isModerator: true }, { name: "Fani", isModerator: true }, { name: "Bima", isModerator: true }, { name: "Cita", isModerator: true }] },
            { id: 5, name: "Penulis Kreatif", category: "Puisi", description: "Menulis cerita dan puisi yang menyentuh hati. Untuk penulis yang ingin berkembang.", members: 300, image: "https://picsum.photos/600/400?writing", badge: null, joined: false, createdDate: "Februari 2024", creator: "Dewi Lestari", onlineMembers: 20, moderators: [{ name: "Gita", isModerator: true }] },
            { id: 6, name: "Desain UI/UX", category: "Desain", description: "Mendesain antarmuka pengguna modern dengan fokus pada pengalaman pengguna.", members: 700, image: "https://picsum.photos/600/400?uiux", badge: "populer", joined: false, createdDate: "November 2022", creator: "Rian Nugraha", onlineMembers: 40, moderators: [{ name: "Hadi", isModerator: true }, { name: "Lia", isModerator: true }, { name: "Vina", isModerator: true }] },
            { id: 7, name: "Fotografi Kreatif", category: "Fotografi", description: "Abadikan momen dengan lensa kreativitas. Diskusi tentang teknik dan inspirasi fotografi.", members: 500, image: "https://picsum.photos/600/400?photography", badge: "populer", joined: false, createdDate: "Mei 2023", creator: "Tia Melinda", onlineMembers: 35, moderators: [{ name: "Tono", isModerator: true }, { name: "Maya", isModerator: true }, { name: "Rudi", isModerator: true }, { name: "Sari", isModerator: true }] },
            { id: 999, name: "Komunitas Umum", category: "Umum", description: "Tempat untuk berbagai diskusi kreatif dan kolaborasi lintas kategori.", members: 100, image: "https://picsum.photos/600/400?general", badge: null, joined: false, createdDate: "Oktober 2024", creator: "Admin Tara", onlineMembers: 10, moderators: [{ name: "Admin", isModerator: true }] }
        ];

        // Simulated Notification Data
        const notifications = [
            { id: 1, text: "New post in Komunitas Puisi: 'Puisi Senja'", time: "2 jam lalu", communityId: 1, read: false, type: "post" },
            { id: 2, text: "Event baru di Komunitas Desain: 'Workshop UI'", time: "4 jam lalu", communityId: 2, read: false, type: "event" },
            { id: 3, text: "Diskusi baru di Komunitas Puisi: 'Sastra Modern'", time: "6 jam lalu", communityId: 1, read: false, type: "post" },
            { id: 4, text: "New post in Komunitas Desain: 'Tips Desain Minimalis'", time: "1 hari lalu", communityId: 2, read: true, type: "post" },
            { id: 5, text: "Komunitas Musik mengadakan sesi jamming virtual!", time: "3 jam lalu", communityId: 3, read: false, type: "event" },
            { id: 6, text: "New post in Komunitas Coding: 'Panduan Python'", time: "5 jam lalu", communityId: 4, read: true, type: "post" },
            { id: 7, text: "Balasan baru pada thread 'Sastra Modern' di Komunitas Puisi", time: "1 jam lalu", communityId: 1, read: false, type: "reply", threadId: 2 }
        ];

        // Simulated Community Posts Data
        const communityPosts = [
            { id: 1, communityId: 1, title: "Puisi Senja", content: "Sebuah puisi tentang keindahan senja di ufuk barat, menggambarkan perasaan damai dan nostalgia.", time: "2 jam lalu", votes: 42, pinned: true, attachments: [{ type: "image", url: "https://picsum.photos/100/100?poetry" }], replies: 15, lastActivity: new Date().toISOString() },
            { id: 2, communityId: 1, title: "Sastra Modern", content: "Diskusi tentang tren sastra modern di Indonesia, termasuk pengaruh budaya digital.", time: "6 jam lalu", votes: 15, pinned: false, attachments: [{ type: "link", url: "https://example.com/sastra", text: "Referensi Sastra" }], replies: 8, lastActivity: new Date(Date.now() - 3600000).toISOString() },
            { id: 3, communityId: 2, title: "Workshop UI", content: "Acara workshop desain antarmuka pengguna untuk pemula dan profesional.", time: "4 jam lalu", votes: 28, pinned: true, attachments: [], replies: 5, lastActivity: new Date(Date.now() - 4 * 3600000).toISOString() },
            { id: 4, communityId: 2, title: "Tips Desain Minimalis", content: "Panduan untuk menciptakan desain yang bersih, fungsional, dan estetis.", time: "1 hari lalu", votes: 10, pinned: false, attachments: [{ type: "image", url: "https://picsum.photos/100/100?design" }], replies: 3, lastActivity: new Date(Date.now() - 24 * 3600000).toISOString() },
            { id: 5, communityId: 3, title: "Kolaborasi Musik", content: "Ajak musisi lain untuk proyek musik baru, fokus pada genre akustik.", time: "3 jam lalu", votes: 20, pinned: true, attachments: [{ type: "link", url: "https://soundcloud.com/example", text: "Contoh Musik" }], replies: 10, lastActivity: new Date(Date.now() - 3 * 3600000).toISOString() },
            { id: 6, communityId: 4, title: "Hackathon Open-Source", content: "Bergabung dalam hackathon untuk proyek open-source, fokus pada aplikasi web.", time: "5 jam lalu", votes: 18, pinned: true, attachments: [{ type: "link", url: "https://github.com/example", text: "Repo GitHub" }], replies: 7, lastActivity: new Date(Date.now() - 5 * 3600000).toISOString() },
            { id: 7, communityId: 5, title: "Cerita Pendek", content: "Berbagi cerita pendek tentang petualangan di kota kecil.", time: "8 jam lalu", votes: 12, pinned: false, attachments: [], replies: 4, lastActivity: new Date(Date.now() - 8 * 3600000).toISOString() },
            { id: 8, communityId: 6, title: "Desain UX Mobile", content: "Diskusi tentang tren desain UX untuk aplikasi mobile.", time: "10 jam lalu", votes: 25, pinned: false, attachments: [], replies: 6, lastActivity: new Date(Date.now() - 10 * 3600000).toISOString() },
            { id: 9, communityId: 7, title: "Tips Fotografi Malam", content: "Panduan untuk mengambil foto malam dengan pencahayaan minim.", time: "12 jam lalu", votes: 30, pinned: true, attachments: [{ type: "image", url: "https://picsum.photos/100/100?photography" }], replies: 9, lastActivity: new Date(Date.now() - 12 * 3600000).toISOString() },
            { id: 999, communityId: 999, title: "Selamat Datang!", content: "Selamat datang di komunitas ini! Mulai diskusi Anda di sini.", time: "Baru saja", votes: 0, pinned: false, attachments: [], replies: 0, lastActivity: new Date().toISOString() }
        ];

        // Simulated Community Events Data
        const communityEvents = [
            { id: 1, communityId: 1, name: "Pembacaan Puisi Senja", date: "25 Juli 2025", type: "Offline" },
            { id: 2, communityId: 1, name: "Workshop Penulisan Puisi", date: "30 Juli 2025", type: "Online" },
            { id: 3, communityId: 2, name: "UI/UX Design Webinar", date: "28 Juli 2025", type: "Online" },
            { id: 4, communityId: 2, name: "Pameran Desain", date: "5 Agustus 2025", type: "Offline" },
            { id: 5, communityId: 3, name: "Konser Musik Muda", date: "27 Juli 2025", type: "Offline" },
            { id: 6, communityId: 4, name: "Hackathon Coding", date: "2 Agustus 2025", type: "Online" },
            { id: 7, communityId: 5, name: "Diskusi Cerita Pendek", date: "3 Agustus 2025", type: "Online" },
            { id: 8, communityId: 6, name: "Workshop UX Research", date: "4 Agustus 2025", type: "Online" },
            { id: 9, communityId: 7, name: "Pameran Fotografi", date: "6 Agustus 2025", type: "Offline" },
            { id: 999, communityId: 999, name: "Sesi Perkenalan Komunitas", date: "1 Agustus 2025", type: "Online" }
        ];

        // Get Community ID from URL
        function getCommunityId() {
            const params = new URLSearchParams(window.location.search);
            const id = parseInt(params.get('community')) || 1;
            return communities.find(c => c.id === id) ? id : 999;
        }

        // Render Community Details
        function renderCommunityDetails() {
            const communityId = getCommunityId();
            const community = communities.find(c => c.id === communityId) || communities.find(c => c.id === 999);
            document.getElementById('community-image').src = community.image;
            document.getElementById('community-image').alt = community.name;
            document.getElementById('community-name').textContent = community.name;
            document.getElementById('community-badge').className = community.badge ? `badge badge-${community.badge}` : '';
            document.getElementById('community-badge').textContent = community.badge ? community.badge.charAt(0).toUpperCase() + community.badge.slice(1) : '';
            document.getElementById('community-description').textContent = community.description;
            document.getElementById('community-members').innerHTML = `<i class="fas fa-user-friends mr-1"></i>${community.members} Anggota`;
        }

        // Render Sidebar Community Details
        function renderSidebarDetails() {
            const communityId = getCommunityId();
            const community = communities.find(c => c.id === communityId) || communities.find(c => c.id === 999);
            const posts = communityPosts.filter(p => p.communityId === communityId) || [communityPosts.find(p => p.id === 999)];

            document.getElementById('sidebar-community-name').textContent = community.name;
            document.getElementById('sidebar-community-category').innerHTML = `<i class="fas fa-tag mr-1"></i>Kategori: ${community.category}`;
            document.getElementById('sidebar-community-description').textContent = community.description;
            document.getElementById('sidebar-community-creator').innerHTML = `<i class="fas fa-user mr-1"></i>Pembuat: ${community.creator}`;
            document.getElementById('sidebar-community-created').innerHTML = `<i class="fas fa-calendar-alt mr-1"></i>Dibuat: ${community.createdDate}`;
            document.getElementById('sidebar-community-discussions').innerHTML = `<i class="fas fa-comment-alt mr-1"></i>Total Diskusi: ${posts.length}`;
            const moderators = community.moderators.slice(0, 1);
            document.getElementById('sidebar-community-moderators').innerHTML = `<i class="fas fa-user-shield mr-1"></i>Moderator: ${moderators.map(m => `${m.name}${m.isModerator ? ' <span class="badge badge-moderator">Moderator</span>' : ''}`).join(", ")}`;
            document.getElementById('sidebar-community-members').innerHTML = `<i class="fas fa-user-friends mr-1"></i>${community.members} Anggota`;
            document.getElementById('sidebar-community-online').innerHTML = `<i class="fas fa-circle text-green-500 mr-1 text-xs"></i>${community.onlineMembers} Online`;

            // Show "Show More" button if more than 3 moderators
            const showMoreBtn = document.getElementById('show-more-moderators');
            if (community.moderators.length > 3) {
                showMoreBtn.classList.remove('hidden');
                showMoreBtn.onclick = toggleModeratorModal;
            } else {
                showMoreBtn.classList.add('hidden');
            }

            // Render Community Events
            const events = communityEvents.filter(e => e.communityId === communityId) || [communityEvents.find(e => e.id === 999)];
            const eventsContainer = document.getElementById('sidebar-community-events');
            eventsContainer.innerHTML = events.map(e => `
                <div class="event-item" onclick="viewEvent(${e.id})">
                    <p class="text-sm font-medium text-gray-700">${e.name}</p>
                    <p class="text-xs text-gray-500">${e.date} • ${e.type}</p>
                </div>
            `).join('');
        }

        // Render Moderator Modal
        function renderModeratorModal() {
            const communityId = getCommunityId();
            const community = communities.find(c => c.id === communityId) || communities.find(c => c.id === 999);
            const moderatorList = document.getElementById('moderator-list');
            moderatorList.innerHTML = community.moderators.map(m => `
                <li class="moderator-item">
                    <div class="moderator-icon"><i class="fas fa-user"></i></div>
                    <span class="moderator-name">${m.name}</span>
                    ${m.isModerator ? '<span class="badge badge-moderator">Moderator</span>' : ''}
                </li>
            `).join('');

            // Animate Moderator List Items
            gsap.from(".moderator-item", {
                opacity: 0,
                y: 20,
                duration: 0.5,
                stagger: 0.1,
                ease: "power3.out"
            });
        }

        // Toggle Moderator Modal
        function toggleModeratorModal() {
            const modal = document.getElementById('moderator-modal');
            const isOpen = modal.classList.contains('open');
            modal.classList.toggle('open');
            gsap.to(modal, {
                opacity: isOpen ? 0 : 1,
                duration: 0.3,
                ease: "power2.out",
                onComplete: () => {
                    if (isOpen) modal.style.visibility = 'hidden';
                    else modal.style.visibility = 'visible';
                }
            });
            if (!isOpen) {
                renderModeratorModal();
            }
        }

        // Render Community Posts
        function renderCommunityPosts() {
            const communityId = getCommunityId();
            let posts = communityPosts.filter(p => p.communityId === communityId);
            const postsContainer = document.getElementById('community-posts');
            postsContainer.innerHTML = '';

            if (posts.length === 0) {
                posts = [communityPosts.find(p => p.id === 999)];
            }

            // Sort posts to highlight active ones (based on recent activity or high votes)
            posts.sort((a, b) => {
                const aActivity = new Date(a.lastActivity).getTime();
                const bActivity = new Date(b.lastActivity).getTime();
                return bActivity - aActivity || b.votes - a.votes;
            });

            posts.forEach(post => {
                const isHighlighted = post.replies > 5 || post.votes > 20 || (new Date().getTime() - new Date(post.lastActivity).getTime()) < 2 * 3600000;
                postsContainer.innerHTML += `
                    <div class="post-card ${isHighlighted ? 'highlight-post' : ''}">
                        <div class="inner">
                            <div class="flex items-center gap-2 mb-2">
                                <h3 class="flex-1">${post.title}</h3>
                                ${post.pinned ? '<i class="fas fa-thumbtack text-yellow-400" title="Pinned Post"></i>' : ''}
                            </div>
                            <p>${post.content}</p>
                            ${post.attachments.length > 0 ? `
                                <div class="attachment-container">
                                    ${post.attachments.map(att => att.type === 'image' ? `<img src="${att.url}" alt="Attachment" />` : `<a href="${att.url}" target="_blank">${att.text}</a>`).join('')}
                                </div>
                            ` : ''}
                            <div class="post-footer">
                                <div class="vote-container">
                                    <i class="fas fa-arrow-up vote-btn" onclick="votePost(${post.id}, 1)"></i>
                                    <span class="text-sm text-gray-500">${post.votes}</span>
                                    <i class="fas fa-arrow-down vote-btn" onclick="votePost(${post.id}, -1)"></i>
                                </div>
                                <div class="flex items-center gap-4">
                                    <span class="text-xs text-gray-500"><i class="fas fa-comment mr-1"></i>${post.replies} Balasan</span>
                                    <span class="text-xs text-gray-500">${post.time}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Render Notifications in Modal
        function renderNotifications(filter = 'all') {
            const notificationList = document.getElementById('notification-list');
            notificationList.innerHTML = '';

            let filteredNotifications = filter === 'all' ? notifications : notifications.filter(n => !n.read);

            if (filteredNotifications.length === 0) {
                notificationList.innerHTML = `
                    <div class="text-center text-gray-600">
                        <p class="text-sm">Tidak ada notifikasi ${filter === 'all' ? '' : 'belum dibaca'}.</p>
                    </div>
                `;
                return;
            }

            filteredNotifications.forEach(notification => {
                notificationList.innerHTML += `
                    <div class="notification-card ${notification.read ? '' : 'unread'}" onclick="viewNotification(${notification.id})">
                        <p class="font-medium">${notification.text}</p>
                        <p class="time">${notification.time}</p>
                    </div>
                `;
            });

            // Update unread count
            const unreadCount = notifications.filter(n => !n.read).length;
            document.getElementById('unread-count').textContent = unreadCount;

            // Animate Notification Cards
            gsap.from(".notification-card", {
                opacity: 0,
                y: 20,
                duration: 0.8,
                stagger: 0.1,
                ease: "power3.out"
            });
        }

        // Toggle Notifications Modal
        function toggleNotifications() {
            const modal = document.getElementById('notification-modal');
            const isOpen = modal.classList.contains('open');
            modal.classList.toggle('open');
            gsap.to(modal, {
                x: isOpen ? '100%' : '0%',
                duration: 0.3,
                ease: "power2.out"
            });
            if (!isOpen) {
                renderNotifications();
            }
        }

        // Mark All Notifications as Read
        function markAllAsRead() {
            notifications.forEach(n => n.read = true);
            renderNotifications(document.querySelector('#notification-modal .filter-btn.active')?.dataset.filter || 'all');
            anime({
                targets: '#mark-all-read',
                scale: [1, 1.1, 1],
                backgroundColor: ['#111827', '#374151', '#111827'],
                color: ['#ffffff', '#facc15', '#ffffff'],
                duration: 300,
                easing: 'easeOutQuad'
            });
        }

        // View Notification
        function viewNotification(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            notification.read = true;
            renderNotifications(document.querySelector('#notification-modal .filter-btn.active')?.dataset.filter || 'all');
            if (notification.type === 'post' || notification.type === 'reply') {
                window.location.href = `/forum.html?community=${notification.communityId}&thread=${notification.threadId || notification.id}`;
            } else if (notification.type === 'event') {
                viewEvent(notification.id);
            }
        }

        // View Event
        function viewEvent(eventId) {
            window.location.href = `/agenda.html?event=${eventId}`;
        }

        // Vote Post
        function votePost(postId, value) {
            const post = communityPosts.find(p => p.id === postId);
            post.votes += value;
            post.lastActivity = new Date().toISOString();
            renderCommunityPosts();
            // Add notification for high-vote posts
            if (post.votes >= 20) {
                notifications.unshift({
                    id: notifications.length + 1,
                    text: `Thread "${post.title}" mendapatkan banyak apresiasi!`,
                    time: "Baru saja",
                    communityId: post.communityId,
                    read: false,
                    type: "post",
                    threadId: post.id
                });
                renderNotifications(document.querySelector('#notification-modal .filter-btn.active')?.dataset.filter || 'all');
            }
        }

        // Toggle Join Community
        function toggleJoin() {
            const communityId = getCommunityId();
            const community = communities.find(c => c.id === communityId) || communities.find(c => c.id === 999);
            const notificationBar = document.getElementById('notification-bar');
            notificationBar.querySelector('p').textContent = community.joined ? 
                `Anda telah bergabung dengan ${community.name}!` : 
                `Anda telah keluar dari ${community.name}.`;
            notificationBar.classList.remove('hidden');
            gsap.from(notificationBar, { opacity: 0, y: -20, duration: 0.5, ease: "power2.out" });

            // Add new notification
            if (community.joined) {
                notifications.unshift({
                    id: notifications.length + 1,
                    text: `Anda telah bergabung dengan ${community.name}!`,
                    time: "Baru saja",
                    communityId: community.id,
                    read: false,
                    type: "join"
                });
                renderNotifications(document.querySelector('#notification-modal .filter-btn.active')?.dataset.filter || 'all');
            }

            // Update sidebar community details
            renderSidebarDetails();
        }

        // Dismiss Notification Bar
        function dismissNotification() {
            const notificationBar = document.getElementById('notification-bar');
            gsap.to(notificationBar, {
                opacity: 0,
                y: -20,
                duration: 0.5,
                ease: "power2.in",
                onComplete: () => {
                    notificationBar.classList.add('hidden');
                    notificationBar.querySelector('p').textContent = 'Selamat datang di komunitas! Lihat aktivitas terbaru.';
                }
            });
        }

        // Filter Functionality for Notifications
        const notificationFilterButtons = document.querySelectorAll('#notification-modal .filter-btn');
        notificationFilterButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                notificationFilterButtons.forEach(f => f.classList.remove('active'));
                btn.classList.add('active');
                renderNotifications(btn.dataset.filter);
                anime({
                    targets: btn,
                    scale: [1, 1.1, 1],
                    backgroundColor: ['#f3f4f6', '#111827'],
                    color: ['#374151', '#ffffff'],
                    duration: 300,
                    easing: 'easeOutQuad'
                });
            });
        });

        // Mark All as Read Button
        document.getElementById('mark-all-read').addEventListener('click', markAllAsRead);

        // Initialize
        document.getElementById('notification-bar').classList.remove('hidden');
        renderCommunityDetails();
        renderSidebarDetails();
        renderCommunityPosts();
        renderNotifications();
    </script>
</body>
</html>